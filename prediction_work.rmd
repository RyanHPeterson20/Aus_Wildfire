---
title: "prediction_work"
author: "Ryan Peterson"
date: "2024-10-28"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r library}
suppressMessages(library(genlasso)) #used for fused lasso 
```

# Data Set-Up

```{r data}
setwd("~/CO_AUS/Aus_CO-main")

load( "ne_data.rda")
load( "se_data.rda")

load( "bounded_data.rda")
load( "data_matrix.rda")

load( "lag_list.rda")
```


## Data Prep

```{r group_response}
NEbase_matrix <- scale(resp_matrix[, 1:32], center = TRUE, scale = FALSE)

SEbase_matrix <- scale(resp_matrix[,33:64], center = TRUE, scale = FALSE)

#group response matrices

#NEAus
NEAus_1 <- NEbase_matrix[ ,1:3]
NEAus_2 <- NEbase_matrix[ ,4:8]
NEAus_3 <- NEbase_matrix[ ,9:12]
NEAus_4 <- NEbase_matrix[ ,13:17]
NEAus_5 <- NEbase_matrix[ ,18:21]
NEAus_6 <- NEbase_matrix[ ,22:32]

#SEAus
SEAus_1 <- SEbase_matrix[ ,1:3]
SEAus_2 <- SEbase_matrix[ ,4:7]
SEAus_3 <- SEbase_matrix[ ,8:16]
SEAus_4 <- SEbase_matrix[ ,17:20]
SEAus_5 <- SEbase_matrix[ ,21:32]

NEAus_mat <- list(NEAus_1, NEAus_2, NEAus_3, NEAus_4, NEAus_5, NEAus_6)
SEAus_mat <- list(SEAus_1, SEAus_2, SEAus_3, SEAus_4, SEAus_5)


#group response vectors list (as function)
#TODO: refine the following functions

#NE resp vectors
NEresp_grouping <- function(NEAus_mat, j = (1:19)){
  
  NEAus_mat <- lapply(NEAus_mat, function(mat) mat[j, ])
  
  NEAus1_resp <- as.vector(NEAus_mat[[1]])
  NEAus2_resp <- as.vector(NEAus_mat[[2]])
  NEAus3_resp <- as.vector(NEAus_mat[[3]])
  NEAus4_resp <- as.vector(NEAus_mat[[4]])
  NEAus5_resp <- as.vector(NEAus_mat[[5]])
  NEAus6_resp <- as.vector(NEAus_mat[[6]])
  
  NEAus_vec <- list(NEAus1_resp, NEAus2_resp, NEAus3_resp,
                    NEAus4_resp, NEAus5_resp, NEAus6_resp)
  
  return(NEAus_vec)
}

#SE resp vectors
SEresp_grouping <- function(SEAus_mat, j = (1:19)){
  
  SEAus_mat <- lapply(SEAus_mat, function(mat) mat[j, ])
  
  SEAus1_resp <- as.vector(SEAus_mat[[1]])
  SEAus2_resp <- as.vector(SEAus_mat[[2]])
  SEAus3_resp <- as.vector(SEAus_mat[[3]])
  SEAus4_resp <- as.vector(SEAus_mat[[4]])
  SEAus5_resp <- as.vector(SEAus_mat[[5]])
  
  SEAus_vec <- list(SEAus1_resp, SEAus2_resp, SEAus3_resp,
                    SEAus4_resp, SEAus5_resp)
  
  return(SEAus_vec) 
}  
```


```{r lagpred_functions}
#lag predictor set-up
#TODO: fine tune these functions for different groups

## NE lag predictors
NElag_grouping <- function(NE_laglist, j = (1:19)){
  #row inclusion
  #j <- (1:19)


  #NE group 1: 35-37
  NE1_lag <- NE_laglist$`Week  35`[j, -(1:2)]
  NE1_lag <- rbind(NE1_lag, NE_laglist$`Week  36`[j, -(1:2)], NE_laglist$`Week  37`[j, -(1:2)])

  #NE group 2: 38-42
  NE2_lag <- NE_laglist$`Week  38`[j,-(1:2)]
  NE2_lag <- rbind(NE2_lag, NE_laglist$`Week  39`[j,-(1:2)], NE_laglist$`Week  40`[j,-(1:2)],
                 NE_laglist$`Week  41`[j,-(1:2)], NE_laglist$`Week  42`[j,-(1:2)])

  #NE group 3: 43-46
  NE3_lag <- NE_laglist$`Week  43`[j,-(1:2)]
  NE3_lag <- rbind(NE3_lag, NE_laglist$`Week  44`[j,-(1:2)], NE_laglist$`Week  45`[j,-(1:2)],
                 NE_laglist$`Week  46`[j,-(1:2)])

  #NE group 4: 47-51
  NE4_lag <- NE_laglist$`Week  47`[j,-(1:2)]
  NE4_lag <- rbind(NE4_lag, NE_laglist$`Week  48`[j,-(1:2)], NE_laglist$`Week  49`[j,-(1:2)],
                 NE_laglist$`Week  50`[j,-(1:2)], NE_laglist$`Week  51`[j,-(1:2)])

  #NE group 5: 52, 1-3
  NE5_lag <- NE_laglist$`Week  52`[j,-(1:2)]
  NE5_lag <- rbind(NE5_lag, NE_laglist$`Week  1`[j,-(1:2)], NE_laglist$`Week  2`[j,-(1:2)],
                 NE_laglist$`Week  3`[j,-(1:2)])

  #NE group 6: 4-14
  NE6_lag <- NE_laglist$`Week  4`[j,-(1:2)]
  NE6_lag <- rbind(NE6_lag, NE_laglist$`Week  5`[j,-(1:2)], NE_laglist$`Week  6`[j,-(1:2)],
                 NE_laglist$`Week  7`[j,-(1:2)], NE_laglist$`Week  8`[j,-(1:2)],
                 NE_laglist$`Week  9`[j,-(1:2)], NE_laglist$`Week  10`[j,-(1:2)],
                 NE_laglist$`Week  11`[j,-(1:2)], NE_laglist$`Week  12`[j,-(1:2)],
                 NE_laglist$`Week  13`[j,-(1:2)], NE_laglist$`Week  14`[j,-(1:2)])

  NEAus_preds <- list(NE1_lag, NE2_lag, NE3_lag, NE4_lag, NE5_lag, NE6_lag)
  return(NEAus_preds)
}  
  
## SE lag predictors
SElag_grouping <- function(SE_laglist, j = (1:19)){

  #SE group 1: 35-37
  SE1_lag <- SE_laglist$`Week  35`[j,-(1:2)]
  SE1_lag <- rbind(SE1_lag, SE_laglist$`Week  36`[j,-(1:2)], SE_laglist$`Week  37`[j,-(1:2)])
  
  #SE group 2: 38-41
  SE2_lag <- SE_laglist$`Week  38`[j,-(1:2)]
  SE2_lag <- rbind(SE2_lag, SE_laglist$`Week  39`[j,-(1:2)], SE_laglist$`Week  40`[j,-(1:2)],
                   SE_laglist$`Week  41`[j,-(1:2)])
  
  #SE group 3: 42-50
  SE3_lag <- SE_laglist$`Week  42`[j,-(1:2)]
  SE3_lag <- rbind(SE3_lag, SE_laglist$`Week  43`[j,-(1:2)], SE_laglist$`Week  44`[j,-(1:2)],
                   SE_laglist$`Week  45`[j,-(1:2)], SE_laglist$`Week  46`[j,-(1:2)],
                   SE_laglist$`Week  47`[j,-(1:2)], SE_laglist$`Week  48`[j,-(1:2)],
                   SE_laglist$`Week  49`[j,-(1:2)], SE_laglist$`Week  50`[j,-(1:2)])
  
  #SE group 4: 51-52,1-2
  SE4_lag <- SE_laglist$`Week  51`[j,-(1:2)]
  SE4_lag <- rbind(SE4_lag, SE_laglist$`Week  52`[j,-(1:2)], SE_laglist$`Week  1`[j,-(1:2)],
                   SE_laglist$`Week  2`[j,-(1:2)])
  
  #SE group 5: 3-14
  SE5_lag <- SE_laglist$`Week  3`[j,-(1:2)]
  SE5_lag <- rbind(SE5_lag, SE_laglist$`Week  4`[j,-(1:2)], SE_laglist$`Week  5`[j,-(1:2)],
                   SE_laglist$`Week  6`[j,-(1:2)], SE_laglist$`Week  7`[j,-(1:2)],
                   SE_laglist$`Week  8`[j,-(1:2)], SE_laglist$`Week  9`[j,-(1:2)],
                   SE_laglist$`Week  10`[j,-(1:2)], SE_laglist$`Week  11`[j,-(1:2)],
                   SE_laglist$`Week  12`[j,-(1:2)], SE_laglist$`Week  13`[j,-(1:2)],
                   SE_laglist$`Week  14`[j,-(1:2)])
  
  
  
  SEAus_preds <- list(SE1_lag, SE2_lag, SE3_lag, SE4_lag, SE5_lag)
  return(SEAus_preds)
}  
```

# Full Model Fused-Lasso

Not including the 2019/2020 Season

```{r}
#standardized lag predictors sans 2019/2020 seasons
test_preds <- NElag_grouping(NE_laglist = NE_laglist_std, j = -19)
test_resp <- NEresp_grouping(NEAus_mat = NEAus_mat, j = -19)

```

```{r d_matrix}
#TODO: check this to make sure nothing is wrong
##Also, we may need an extra row at the end if AAO 52 keeps being weird
### or reorder the climate index predictors.

D <- getD1d(52)
empty_D <- matrix(rep(0, (52*51)) , ncol = 52, nrow = 51)
D1 <- cbind(D, empty_D, empty_D, empty_D)
D2 <- cbind(empty_D, D, empty_D, empty_D)
D3 <- cbind(empty_D, empty_D, D, empty_D)
D4 <- cbind(empty_D, empty_D, empty_D, D)

#D5 <- cbind(empty_D, empty_D, empty_D, empty_D, D) #OLR matrix
D_new <- rbind(D1, D2, D3, D4)
```


